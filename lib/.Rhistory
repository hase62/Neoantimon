install.packages("devtools")
library("devtools")
setwd("~/Documents/GitHub/Neoantimon/R")
setwd("~/Documents/GitHub/Neoantimon/lib/data")
data("sample_vcf.annovar")
data("sample_vcf.vep")
data("sample_hla_table_c1")
data("sample_refFlat.grch37")
data("sample_refMrna.grch37.fa")
data("sample_result_SNV_CLASS1_ALL")
library(devtools);
install_github('hase62/Neoantimon');
library(Neoantimon);
library(biomaRt)
data("sample_vcf.annovar")
data("sample_vcf.vep")
data("sample_hla_table_c1")
data("sample_refFlat.grch37")
data("sample_refMrna.grch37.fa")
data("sample_result_SNV_CLASS1_ALL")
for(r_code in list.files("./../R/")) source(paste("./../R/", r_code, sep = ""))
MainSNVClass1(input_annovar_format_file = sample_vcf.annovar,
hla_types = sample_hla_table_c1[1,-1],
refflat_file = sample_refFlat.grch37,
refmrna_file = sample_refMrna.grch37.fa,
netMHCpan_dir = NA)
write.table(file = "result.ID.SNV1/data.ID_SNV.peptide.SNV_CLASS1_ALL.txt",
x = sample_result_SNV_CLASS1_ALL[grep("0_DHX15", sample_result_SNV_CLASS1_ALL$Gene), ],
row.names = FALSE, quote = FALSE, sep = "\t")
data("sample_vcf.vep")
print(sample_vcf.vep, row.names = FALSE)
data("sample_vcf.snps")
print(sample_vcf.snps, row.row.names = FALSE)
setwd("~/Documents/GitHub/Neoantimon/lib")
Result_HLA1_SNV <- MainSNVClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
SNPs = "data/sample_vcf.snps.vcf",
multiple_variants = TRUE,
MHCflurry = "~/miniforge3/envs/tf/bin/mhcflurry-predict-scan")
Result_HLA1_SNV <- MainSNVClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE,
MHCflurry = "~/miniforge3/envs/tf/bin/mhcflurry-predict-scan")
Result_HLA1_SNV_1 <- CalculatePriorityScores(result = Result_HLA1_SNV[[1]], useRNAvaf = FALSE)
Result_HLA1_SNV_1
print(head(Result_HLA1_SNV_1))
print(Export_Summary_SNV(Input = Result_HLA1_SNV_1, Mut_IC50_th = 500, Wt_IC50_th = 500))
Result_HLA1_SNV_1 <- CalculatePriorityScores(result = Result_HLA1_SNV[[1]], useRNAvaf = FALSE)
Result_HLA1_SNV_1
Result_HLA1_SNV <- MainSNVClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE)
Result_HLA1_INDEL <- MainINDELClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
SNPs = "data/sample_vcf.snps.vcf",
multiple_variants = TRUE,
MHCflurry = "~/opt/anaconda3/bin/mhctools")
Result_HLA1_INDEL <- MainINDELClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE,
MHCflurry = "~/opt/anaconda3/bin/mhctools")
hmdir = getwd()
input_dir <- "result.ID.SNV1/"
file_prefix <- "sample_vcf.annovar.txt.ID_SNV"
print("Merging Results...")
dir<-paste(hmdir, input_dir, sep="/")
files<-list.files(paste(dir, sep="/"))
#Get Peptide Info
files_part<-files[intersect(grep("HLACLASS1", files), grep(file_prefix, files))]
files_part
grep("ALL.txt", files_part)
grep("ALL.txt", files_part, invert = TRUE, value = TRUE)
#Get Peptide Info
files_part<-files[intersect(grep("HLACLASS1", files), grep(file_prefix, files))]
files_part<-grep("ALL.txt", files_part, invert = TRUE, value = TRUE)
files_part
files_part<-grep("ALL.txt", files_part, invert = TRUE, value = TRUE)
files_part
if(length(files_part)==0){
print("No File Detected!!")
return(NULL)
}
#allele,start,end,length,peptide,ic50,Rank,Peptide_Normal_Sep,norm_ic_50,norm_Rank
full_peptide<-NULL
for(f in files_part[grep("\\.peptide\\.txt", files_part)]){
print(paste(dir, f, sep="/"))
a
}
test1<-scan(paste(dir, f, sep="/"), "character", sep="\n", skip=1)
test1<-gsub(" <= WB", "", test1)
ss1<-grep(" Pos ", test1)+2
ee1<-grep("Protein", test1)-2
num1<-sapply(gsub("[ ]+","\t",test1[ss1]), function(x) strsplit(x, "\t")[[1]][12])
num1
test2<-scan(paste(dir, sub("peptide\\.txt", "wtpeptide\\.txt", f), sep="/"),"character", sep="\n",skip=1)
test2<-gsub(" <= WB", "", test2)
ss2<-grep(" Pos ", test2)+2
ee2<-grep("Protein", test2)-2
num2<-sapply(gsub("[ ]+","\t",test2[ss2]), function(x) strsplit(x, "\t")[[1]][12])
#if(length(grep("No peptides derived", test1[1:45]))>0) next
if(length(grep("cannot be found in hla_pseudo list", test1))>0) next
if(length(grep("Could not find allele", test1))>0) next
num1
length(num1)
h1 <- 1
print(paste((h1 / length(num1)) * 100, "perc. fin"))
#Skip if not match
if(is.na(grep(num1[h1], info[,2])[1]))next
d4<-NULL
hit<-match(num1[h1], num2)
hit
num2
ss1
ee1
test1
test1[ss1[h1]]
test1[ss1[h1] - 1]
test1[ss1[h1] - 2]
strsplit(test1[ss1[h1] - 2], "\t")[[1]]
strsplit(test1[ss1[h1] - 2], " ")[[1]]
strsplit(test1[ss1[h1] - 2], " +")[[1]]
strsplit(test1[ss1[h1]], " +")[[1]]
match(strsplit(test1[ss1[h1] - 2], " +")[[1]], "Pos")
match(c("Pos", "MHC", "Peptide", "Identity", "Score_EL", "%Rank_EL"), strsplit(test1[ss1[h1] - 2], " +")[[1]])
column_extracted <- match(c("Pos", "MHC", "Peptide", "Identity", "Score_EL", "%Rank_EL"),
strsplit(test1[ss1[h1] - 2], " +")[[1]])
column_extracted_1 <- match(c("Pos", "MHC", "Peptide", "Identity", "Score_EL", "%Rank_EL"),
strsplit(test1[ss1[h1] - 2], " +")[[1]])
column_extracted_1
column_extracted_2 <- match(c("Pos", "MHC", "Peptide", "Identity", "Score_EL", "%Rank_EL"),
strsplit(test2[ss1[h1] - 2], " +")[[1]])
hit
test2[ss1[hit] - 2]
column_extracted_2 <- match(c("Pos", "MHC", "Peptide", "Identity", "Score_EL", "%Rank_EL"),
strsplit(test2[ss1[hit] - 2], " +")[[1]])
d2<-t(sapply(gsub("[ ]+", "\t", test2[ss2[hit]:ee2[hit]]), function(x) strsplit(x, "\t")[[1]][column_extracted_2]))
d1<-t(sapply(gsub("[ ]+", "\t", test1[ss1[h1]:ee1[h1]]), function(x) strsplit(x, "\t")[[1]][column_extracted_1]))
d1
d1[1]
d1[1,]
d2[1,]
Result_HLA1_SNV <- MainSNVClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE)
for(r_code in list.files("./../R/")) source(paste("./../R/", r_code, sep = ""))
Result_HLA1_SNV <- MainSNVClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE)
Result_HLA1_SNV_1 <- CalculatePriorityScores(result = Result_HLA1_SNV[[1]], useRNAvaf = FALSE)
for(r_code in list.files("./../R/")) source(paste("./../R/", r_code, sep = ""))
list.files("./../R/")
Export_Summary_SNV(Input = Result_HLA1_SNV_1, Mut_IC50_th = 500, Wt_IC50_th = 500)
Export_Summary_SNV(Input = Result_HLA1_SNV_1, Mut_Rank_th = 0.05, Wt_Rank_th = 0.05)
Result_HLA1_INDEL <- MainINDELClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE)
Result_HLA1_INDEL_1 <- CalculatePriorityScores(result = Result_HLA1_INDEL[[1]], useRNAvaf = FALSE)
Export_Summary_IndelSV(Input = Result_HLA1_INDEL, , Mut_Rank_th = 0.05, Wt_Rank_th = 0.05)
Export_Summary_IndelSV(Input = Result_HLA1_INDEL, , Mut_Rank_th = 0.05)
column_extracted_1
strsplit(test1[ss1[h1] - 2], " +")[[1]]
column_extracted <- match(c("MHC", "Pos", "Identity", "Icore", "Peptide", "Score_EL", "%Rank_EL"),
strsplit(test1[ss1[h1] - 2], " +")[[1]])
column_extracted
d1<-t(strsplit(gsub("[ ]+", "\t", test1[ss1[h1]:ee1[h1]]), "\t")[[1]][column_extracted])
d1
match(c("Pos", "MHC", "Peptide", "Identity", "Score_EL", "%Rank_EL"),
strsplit(test1[ss1[h1] - 2], " +")[[1]])
column_extracted
Result_HLA1_INDEL <- MainINDELClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE,
base_0 = TRUE)
Result_HLA1_INDEL <- MainINDELClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE,
base_0 = FALSE)
Result_HLA1_INDEL <- MainINDELClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE,
base_0 = FALSE)
Result_HLA1_INDEL <- MainINDELClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE,
base_0 = TRUE)
Result_HLA1_INDEL <- MainINDELClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE,
base_0 = FALSE)
Result_HLA1_INDEL <- MainINDELClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE,
base_0 = TRUE)
Result_HLA1_INDEL <- MainINDELClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE,
base_0 = FALSE)
TRUE
Result_HLA1_INDEL <- MainINDELClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE,
base_0 = TRUE)
Result_HLA1_INDEL <- MainINDELClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE,
base_0 = FALSE)
for(r_code in list.files("./../R/")) source(paste("./../R/", r_code, sep = ""))
Result_HLA1_SNV <- MainSNVClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE)
Export_Summary_SNV(Input = Result_HLA1_SNV_1, Mut_Rank_th = 0.05, Wt_Rank_th = 0.05)
Result_HLA1_INDEL <- MainINDELClass1(input_annovar_format_file = "data/sample_vcf.annovar.txt",
file_name_in_hla_table = "sample",
hla_file = "data/sample_hla_table_c1.txt",
refflat_file  = "refFlat.grch37.txt",
refmrna_file = "refMrna.grch37.fa",
rnaexp_file = "data/sample_rna_exp.txt",
netMHCpan_dir = "netMHCpan-4.1/netMHCpan",
depth_tumor_column = 12,
depth_normal_column = 14,
multiple_variants = TRUE,
base_0 = FALSE)
